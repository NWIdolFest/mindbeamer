#!/usr/bin/env bash
# <Script Name>
# <Description what this module does>
# Written by <Author>
# GPL V3
########


# Source error handling, leave this in place
set -x
set -e

source /common.sh
install_cleanup_trap

unpack /filesystem/home/pi /home/"${BASE_USER}" "${BASE_USER}"
unpack /filesystem/boot /boot
#unpack /filesystem/opt /opt

mkdir -p /opt/mindbeamer
chown pi:pi /opt/mindbeamer
mkdir -p /opt/greengrass
chown pi:pi /opt/greengrass
adduser --system ggc_user
addgroup --system ggc_group
apt install openjdk-8-jdk -y
apt-get install -y gcc g++ make
curl -sSL https://deb.nodesource.com/setup_14.x | bash -
apt-get install -y nodejs
echo "fs.protected_hardlinks = 1" >> /etc/sysctl.d/97-custom.conf
echo "fs.protected_symlinks = 1" >> /etc/sysctl.d/97-custom.conf
echo "disable_overscan=1" >> /boot/config.txt
curl -s https://d2s8p88vqu9w66.cloudfront.net/releases/greengrass-nucleus-latest.zip > /opt/greengrass/greengrass-nucleus-latest.zip

echo "This is an example module, install and set up what you need here!"
echo "$MINDBEAMER_VAR"

# Unpack root at the end, so files are modified before
#unpack /filesystem/root /